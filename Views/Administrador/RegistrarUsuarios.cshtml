@using EduConnect_Front.Dtos
@model EduConnect_Front.Dtos.CrearUsuarioDto
@{
    ViewData["Title"] = "Registrar Usuario";
    Layout = "_LayoutUsuario";
    var carreras = ViewBag.Carreras as List<CarreraDto>;
}
@section Styles {
    <link rel="stylesheet" href="~/estilos/registroUsuarios.css" />
}

<main>
    <section class="left">
        <img src="~/img/RegistroNiña.png" alt="Estudiante">
    </section>

    <section class="right">
        <h1>@ViewData["Title"]</h1>

        <form asp-action="RegistrarUsuarios" asp-controller="Administrador" method="post" class="form-registro">
            @Html.AntiForgeryToken()

            <!-- Errores del back (validaciones del Service de la API) -->
            <div asp-validation-summary="All" class="text-danger"></div>

            <input asp-for="Nombre" type="text" placeholder="NOMBRES" required />
            <input asp-for="Apellido" type="text" placeholder="APELLIDOS" required />

            <select asp-for="IdTipoIdent" required>
                <option value="">TIPO DE DOCUMENTO</option>
                <option value="1">Cédula</option>
                <option value="2">Tarjeta de Identidad</option>
                <option value="3">Pasaporte</option>
            </select>

            <input asp-for="NumIdent" type="text" placeholder="NÚMERO DE DOCUMENTO" required />
            <input asp-for="TelUsu" type="tel" placeholder="TELÉFONO (10 dígitos)" required />
            <input asp-for="Correo" type="email" placeholder="CORREO" required />

            <!-- Si aún no cargas catálogos desde la BD, deja opciones fijas -->
            <select asp-for="IdCarrera" required>
                <option value="">CARRERA</option>
                @if (carreras != null)
                {
                    foreach (var c in carreras)
                    {
                        <option value="@c.IdCarrera">@c.NombreCarrera</option>
                    }
                }
            </select>

            <select asp-for="IdSemestre" required>
                <option value="">SEMESTRE</option>
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
                <option>6</option>
                <option>7</option>
                <option>8</option>
                <option>9</option>
                <option>10</option>
            </select>

            <input asp-for="ContrasUsu" type="password" placeholder="CONTRASEÑA" required />

            <p class="radio-label">Elige el rol del usuario</p>
            <label><input type="radio" asp-for="IdRol" value="2" required /> Tutor</label>
            <label><input type="radio" asp-for="IdRol" value="1" /> Tutorado</label>
            <label><input type="radio" asp-for="IdRol" value="4" /> Coordinador</label>

            <!-- Estado por defecto activo (como en tu back) -->
            <input asp-for="IdEstado" type="hidden" value="1" />

            <div class="acciones">
                
                <button type="submit" class="btn-principal">GUARDAR</button>
                <a asp-controller="Administrador" asp-action="PanelAdministrador" class="btn-secundario">CANCELAR</a>
            </div>
        </form>

        @* Popup de error si la API respondió con fallo *@
        @{
            var error = ViewData.ModelState[string.Empty]?.Errors.FirstOrDefault()?.ErrorMessage;
        }
        @await Html.PartialAsync("_Popup", new EduConnect_Front.Dtos.PopupDto {
        Tipo = "error",
                Titulo = "No se pudo registrar",
                Mensaje = error
                })
    </section>
</main>
<script>
    // Validar que solo se ingresen números en ambos campos
    const numIdentInput = document.querySelector('input[name="NumIdent"]');
    const telInput = document.querySelector('input[name="TelUsu"]');

    function soloNumeros(input) {
        input.addEventListener('input', function () {
            this.value = this.value.replace(/[^0-9]/g, ''); // elimina todo lo que no sea número
        });
    }

    soloNumeros(numIdentInput);
    soloNumeros(telInput);
</script>