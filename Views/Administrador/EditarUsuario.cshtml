@using EduConnect_Front.Dtos
@model EduConnect_Front.Dtos.ActualizarUsuarioDto
@{
    ViewData["Title"] = "Editar Usuario";
    Layout = "_LayoutUsuario";
    var carreras = ViewBag.Carreras as List<CarreraDto>;
    var tipoIdent = ViewBag.TipoIdent as List<TipoIdentDto>;
}
@section Styles {
    <link rel="stylesheet" href="~/estilos/editarUsuario.css">
}
@if (TempData["Success"] != null)
{
    @await Html.PartialAsync("_Popup", new PopupDto
    {
        Tipo = "exito",
        Titulo = "Perfil actualizado con éxito",
        Mensaje = TempData["Success"] as string
    })
<script>
    setTimeout(() => {
        const popup = document.querySelector('.modal-fondo');
        if (popup) popup.style.display = 'none';
        // 🔹 Redirigir después de 3 segundos
        window.location.href = '@Url.Action("PanelAdministrador", "Administrador")';
    }, 3000);
</script>
}


@if (TempData["Error"] != null)
{
    @await Html.PartialAsync("_Popup", new PopupDto
    {
        Tipo = "error",
        Titulo = "Error al actualizar el perfil",
        Mensaje = TempData["Error"] as string
    })
}
<main class="perfil-container perfil-container2">
    <!-- Panel izquierdo -->
    <section class="perfil-left">

        <div class="avatar">
            <!-- Si no tiene avatar guardado, se muestra avatar1.png -->
            <img id="avatarSeleccionado"
                 src="~/img/avatars/@(Model.Avatar ?? "avatar1.png")"
                 alt="Avatar seleccionado">
        </div>
        <button class="nombre-tutorado">@Model.Nombre.ToUpper() @Model.Apellido.ToUpper()</button>
        <!--Selección de avatares -->
        <div class="avatar-selector">
            <p>Elige tu avatar:</p>
            <div class="avatar-opciones">
                @for (int i = 1; i <= 12; i++)
                {
                    var avatarFile = $"avatar{i}.png";
                    var isSelected = Model.Avatar == avatarFile ? "checked" : "";
                    <label>
                        <input type="radio" name="AvatarRadio" value="@avatarFile" @isSelected />
                        <img src="~/img/avatars/@avatarFile" alt="Avatar @i" />
                    </label>
                }
            </div>
        </div>
    </section>

    <!-- Panel derecho -->
    <section class="perfil-right">
        <form asp-action="EditarUsuario" asp-controller="Administrador" method="post">
        @Html.AntiForgeryToken()
        <h1><img src="~/img/IconoEditar.png" alt="icono editar"> EDITAR PERFIL</h1>
            
            <input type="hidden" id="Avatar" name="Avatar" value="@Model.Avatar" />
            <input type="hidden" asp-for="IdUsu" />

            <div class="form-grid">
                <div>
                    <label>Nombre</label>
                    <input asp-for="Nombre" type="text" placeholder="NOMBRES" required />
                </div>

                <div>
                    <label>Apellido</label>
                    <input asp-for="Apellido" type="text" placeholder="APELLIDOS" required />
                </div>

                <div>
                    <label>Tipo de documento</label>
                    <select asp-for="IdTipoIdent" required>

                        <option value="">TIPO DE DOCUMENTO</option>
                        @if (tipoIdent != null)
                        {
                            foreach (var t in tipoIdent)
                            {
                                <option value="@t.IdTipoIdent">@t.Nombre</option>
                            }
                        }
                    </select>
                </div>

                <div>
                    <label>Número de documento</label>
                    <input asp-for="NumIdent" type="text" placeholder="NÚMERO DE DOCUMENTO" required />
                </div>

                <div>
                    <label>Teléfono</label>
                    <input asp-for="TelUsu" type="tel" placeholder="TELÉFONO" required />
                </div>

                <div>
                    <label>Correo</label>
                    <input asp-for="Correo" type="email" placeholder="CORREO" required />
                </div>

                <div>
                    <label>Carrera</label>
                    <select asp-for="IdCarrera" class="form-control" required>
                        <option value="">Seleccione una carrera</option>
                        @if (carreras != null)
                        {
                            foreach (var c in carreras)
                            {
                                <option value="@c.IdCarrera">@c.NombreCarrera</option>
                            }
                        }
                    </select>
                </div>

                <div>
                    <label>Semestre</label>
                    <select asp-for="IdSemestre" class="form-select" required>
                        <option value="">SEMESTRE</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                </div>

                <div>
                    <label>Rol</label>
                    <select asp-for="IdRol" required>
                        <option value="">ROL</option>
                        <option value="1">Tutor</option>
                        <option value="2">Tutorado</option>                      
                        <option value="4">Coordinador</option>
                    </select>
                </div>
            </div>

            <div class="botones-acciones">
                <button type="submit" class="btn-guardar">GUARDAR</button><br /><br />
                <a asp-controller="Administrador" asp-action="ConsultarUsuarios" class="btn-volver">VOLVER</a>
            </div>
        </form>

    </section>
    <!-- Script que actualiza la imagen y el campo hidden -->
    <script>
        document.querySelectorAll("input[name='AvatarRadio']").forEach(radio => {
            radio.addEventListener("change", function () {
                const imgSrc = this.nextElementSibling.getAttribute("src");
                const avatarValue = this.value;
                document.getElementById("avatarSeleccionado").setAttribute("src", imgSrc);
                document.getElementById("Avatar").value = avatarValue;
            });
        });
    </script>

</main>









