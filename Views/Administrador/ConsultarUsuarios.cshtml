@model List<EduConnect_Front.Dtos.ListadoUsuariosDto>

@{
    ViewData["Title"] = "Consultar Usuarios";
    Layout = "_LayoutUsuario";

    // 🔹 Valores manuales para los filtros
    var roles = new List<(int IdRol, string Nombre)>
    {
        (1, "Tutorado"),
        (2, "Tutor"),
        (4, "Coordinador")
    };

    var estados = new List<(int IdEstado, string Nombre)>
    {
        (1, "Activo"),
        (2, "Inactivo")
    };

    var filtroRol = ViewBag.FiltroRol as int?;
    var filtroEstado = ViewBag.FiltroEstado as int?;
    var filtroNumIdent = ViewBag.FiltroNumIdent as string;
}

@section Styles {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="~/estilos/consultarUsuarios.css">
    <link rel="stylesheet" href="~/estilos/popupUsuarios.css">
}

<main>
    <!-- ======= TÍTULO ======= -->
    <h1 class="titulo">🔍CONSULTAR USUARIOS</h1>

    <!-- ======= FORMULARIO DE BÚSQUEDA Y FILTROS ======= -->
    <form method="get" asp-action="ConsultarUsuarios" class="busqueda-filtros">

        <!-- Búsqueda por número de documento -->
        <div class="busqueda">
            <input type="text" name="numIdent" placeholder="NÚMERO DE DOCUMENTO" value="@filtroNumIdent" />
            <button type="submit">🔍</button>
        </div>

        <!-- Panel lateral de filtros -->
        <div class="caja-filtro-img">
            <div class="imagen-filtros">
                <img src="~/img/NiñoLupa.png" alt="Niño con lupa">
            </div>

            <div class="panel-filtros">
                <h3>FILTRAR POR:</h3>

                <label for="rol">Rol</label>
                <select id="rol" name="idRol">
                    <option value="">Seleccionar</option>
                    @foreach (var rol in roles)
                    {
                        <option value="@rol.IdRol" selected="@(rol.IdRol == filtroRol)">
                            @rol.Nombre
                        </option>
                    }
                </select>

                <label for="estado">Estado</label>
                <select id="estado" name="idEstado">
                    <option value="">Seleccionar</option>
                    @foreach (var est in estados)
                    {
                        <option value="@est.IdEstado" selected="@(est.IdEstado == filtroEstado)">
                            @est.Nombre
                        </option>
                    }
                </select>
                <button type="submit" class="btn-aplicar">Aplicar Filtro</button>
            </div>
            
        </div>
        
    </form>

    <!-- ======= TABLA DE USUARIOS ======= -->
      
    <div class="contenido">
        <div class="caja-tabla">
            <table class="tabla-usuarios">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>N° Documento</th>
                        <th>Rol</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var u in Model)
                        {
                            <tr>
                                <td>@u.Nombre</td>
                                <td>@u.Apellido</td>
                                <td>@u.NumIdent</td>
                                <td>@u.Rol</td>                            
                                <td class="estado">@u.Estado</td>
                                <td>
                                    <!-- Botón Ver Detalles -->
                                    <button type="button"
                                            class="boton-ver"
                                            title="Ver detalles"
                                            data-nombre="@u.Nombre"
                                            data-apellido="@u.Apellido"
                                            data-tipo="@u.TipoIdent"
                                            data-num="@u.NumIdent"
                                            data-tel="@u.TelUsu"
                                            data-correo="@u.Correo"
                                            data-carrera="@u.Carrera"
                                            data-semestre="@u.IdSemestre"
                                            data-rol="@u.Rol"
                                            data-estado="@u.Estado">
                                        <i class="fas fa-eye"></i>
                                    </button>

                                    <!-- Botón Editar -->
                                    <button class="boton-editar">
                                        <a asp-controller="Administrador"
                                           asp-action="EditarUsuario"
                                           asp-route-id="@u.IdUsu"
                                           class="boton-editar">
                                            <i class="fas fa-pen"></i>
                                        </a>
                                    </button>


                                    <!-- Botón Eliminar -->
                                    <button type="button"
                                            class="boton-eliminar"
                                            title="Inactivar"
                                            data-id="@u.IdUsu">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        }
                    
                    }else
                    {
                   
                        <tr>
                            <td colspan="5" style="text-align:center; padding:14px;">
                                <p>No hay tutores para mostrar. Ajusta tus filtros y vuelve a intentar.</p>
                                <img src="~/img/PensarSolicitud.png" alt="Avatar tutor">
                                <!-- Botón para volver a cargar todos -->
                                <form asp-controller="Administrador" asp-action="ConsultarUsuarios" method="get">
                                    <button type="submit" class="btn-volver-todos">🔄 Ver todos los usuarios</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- POPUPS -->
    <div id="popup-confirmacion" class="popup" style="display:none;">
        <div class="popup-contenido popup-elim">
            <p class="texto-elim">¿Desea inactivar este usuario?</p>
            <button id="btn-si">Sí, confirmar</button>
            <button id="btn-no">No, cancelar</button>
        </div>
    </div>

    <div id="popup-detalles" class="popup" style="display:none;">
        <div class="popup-contenido">
            <h3>Detalles del Usuario</h3>
            <ul id="detalles-lista"></ul>
            <button class="btn-cerrar-popup">Cerrar</button>
        </div>
    </div>

    <script src="~/js/popupUsuarios.js"></script>
</main>
